<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時辰</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="default">
    
    <link id="favicon" rel="icon" type="image/png" href="">
    <style>
        :root {
            --bg-color: #fcfcfc;
            --text-main: #2d2d2d;
            --bar-bg: #f0f0f0;
        }

        /* OLED Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #000000;
                --text-main: #ffffff;
                --bar-bg: #1a1a1a;
            }
        }

        body, html {
            height: 100%;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            transition: background-color 0.5s ease;
        }

        .container {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .progress-wrapper {
            position: relative;
            width: 70vw; 
            max-width: 1000px;
            height: 28vh; 
            background-color: var(--bar-bg);
            border-radius: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .progress-wrapper { width: 92vw; height: 22vh; border-radius: 30px; }
            .shichen-char { font-size: 6rem !important; }
            .western-time { letter-spacing: 6px !important; font-size: 2.5rem !important; }
        }

        .progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0%;
            transition: width 1s linear, background-color 2s ease;
            z-index: 1;
        }

        .shichen-char {
            font-size: clamp(6rem, 15vw, 15rem);
            z-index: 2;
            position: relative;
            font-weight: bold;
            letter-spacing: -5px;
        }

        .western-time {
            margin-top: 3rem;
            font-size: clamp(1.5rem, 5vw, 4rem);
            font-weight: 200;
            letter-spacing: 10px;
            opacity: 0.7;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-wrapper">
        <div class="progress-fill" id="bar"></div>
        <div class="shichen-char" id="char">--</div>
    </div>
    <div class="western-time" id="clock">00:00:00</div>
</div>

<script>
    // --- APP LOGIC ---
    const shichenData = [
        { char: '子', color: '#a2b9d6' }, { char: '丑', color: '#92a3b5' },
        { char: '寅', color: '#b5a2bd' }, { char: '卯', color: '#9ed9c4' },
        { char: '辰', color: '#c9e3ac' }, { char: '巳', color: '#f7e7a1' },
        { char: '午', color: '#ffcf96' }, { char: '未', color: '#f7b7a3' },
        { char: '申', color: '#eec1ad' }, { char: '酉', color: '#d9a79e' },
        { char: '戌', color: '#b5928d' }, { char: '亥', color: '#8e97b0' }
    ];

    function updateFavicon(char, color) {
        const canvas = document.createElement('canvas');
        canvas.width = 64; canvas.height = 64;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = color;
        ctx.beginPath(); ctx.arc(32, 32, 30, 0, 2 * Math.PI); ctx.fill();
        ctx.fillStyle = '#000000'; 
        ctx.font = 'bold 44px sans-serif';
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        ctx.fillText(char, 32, 34);
        document.getElementById('favicon').href = canvas.toDataURL('image/png');
    }

    let lastChar = "";
    function update() {
        const now = new Date();
        const h = now.getHours();
        const m = now.getMinutes();
        const s = now.getSeconds();

        let index = Math.floor((h + 1) / 2) % 12;
        const current = shichenData[index];

        if (current.char !== lastChar) {
            updateFavicon(current.char, current.color);
            lastChar = current.char;
        }

        let startHour = (index * 2) - 1;
        if (startHour === -1) startHour = 23;
        let hoursSinceStart = h - startHour;
        if (hoursSinceStart < 0) hoursSinceStart += 24;

        const percent = (((hoursSinceStart * 3600) + (m * 60) + s) / 7200) * 100;

        document.getElementById('char').innerText = current.char;
        const bar = document.getElementById('bar');
        bar.style.width = `${percent}%`;
        bar.style.backgroundColor = current.color;
        
        document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB', {
            hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
        });
    }

    setInterval(update, 1000);
    update();

    // --- SERVICE WORKER REGISTRATION ---
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
</script>
</body>
</html>